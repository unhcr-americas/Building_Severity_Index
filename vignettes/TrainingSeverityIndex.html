<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Building Humanitarian Severity Index with R &amp; COINr</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <script src="libs/core-js/shim.min.js"></script>
    <script src="libs/react/react.min.js"></script>
    <script src="libs/react/react-dom.min.js"></script>
    <script src="libs/reactwidget/react-tools.js"></script>
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/reactable-binding/reactable.js"></script>
    <script src="libs/plotly-binding/plotly.js"></script>
    <script src="libs/typedarray/typedarray.min.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main/plotly-latest.min.js"></script>
    <script src="https://use.fontawesome.com/5235085b15.js"></script>
    <link rel="stylesheet" href="unhcr-slides.css" type="text/css" />
    <link rel="stylesheet" href="unhcr-slides-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Building Humanitarian Severity Index with R &amp; COINr
## Ensure Statistical Rigor &amp; Robustness
### 
### Last update: 2022-01-13

---

layout: true

&lt;div class="my-footer"&gt;&lt;span&gt;&lt;/span&gt;&lt;/div&gt; 





---

# Humanitarian Severity Index



.pull-left[

Humanitarian response actors evaluate crisis severity through one consolidated index or multiple sectoral indices.

Each index acts as a metric to quantify and to compare the situation of different admin units within a country. 

Crisis severity is indeed a complex, multi-factorial construct 


CHALLENGE: Summarising and __condensing__ the information of a plurality of underlying indicators into a single measure, in a way that __accurately__ reflects the underlying concept

 
]

 
.pull-right[
 
Example from JRC Global [INFORM]((http://www.inform-index.org)), an index designed to assess humanitarian risks for 191 countries at the national level. 


![Risk](images/inform.png)  


]

???
Depending on the pace of the group, if we do not finish today we will org anise a second session 



---
class: inverse, left, middle

# Aid organisations and donors commit to...

See grand bargain Commitment #5: [Improve joint and impartial needs assessments](https://interagencystandingcommittee.org/improve-joint-and-impartial-needs-assessments)

&gt;  Dedicate resources and involve independent specialists within the clusters to strengthen [..] analysis in a __fully transparent__, collaborative process, which includes a brief summary of the methodological and analytical limitations of the assessment.


???

Notes -


---


## The risk with not statistically-sound index 
 
&gt; "_And so we end up relying on a lot of expert judgment, which in effect means that we’re faking it--we have a process and looks like it’s very rigorous, and in the end is just being done by people’s...assumptions._"

.pull-left[

Conceptual and statistical flaws in the calculation of Humanitarian Severity can greatly limit its usefulness
 
 * Are indicators correctly depicting the severity?
 
 * Are all indicators "really useful" to the final measurement?
  
 * Does the way the indicators are 'assembled" together correctly reflect their true respective importance?

 * Can the methodology be fully __positively audited__?
 
]

 
.pull-right[

![Risk](images/risk.png) 



]


 



???
Composite indicators are developed to address the challenge that comes with the aggregation of heterogeneous information. They are developed to convey consistent policy messages
Because of their very nature, composite indicators cannot be validated versus a ground truth and are always a compromise and as a result tends to create polarized audiences.

Some cons:
Composite indicators may send misleading, non-robust policy messages if they are poorly constructed or misinterpreted. Sensitivity analysis can be used to test composite indicators for robustness.
The simple “big picture” results which composite indicators show may invite politicians to draw simplistic policy conclusions. Composite indicators should be used in combination with the sub-indicators to draw sophisticated policy conclusions.
The construction of composite indicators involves stages where judgement has to be made: the selection of sub-indicators, choice of model, weighting indicators and treatment of missing values etc. These judgements should be transparent and based on sound statistical principles.

Notes - Composite indicators typically seek to reduce distinct quality measures into a single summary indicator. The methods underlying such simplifications should be clear and transparent. Too often, however, composite indicators are presented with limited or no information about the derivation and interpretation of constituent measures. The technical information required to understand how composite indicators were designed is sometimes not published5 or is not reported alongside the actual composite indicator. Some measures are used without clear conceptual justification

A key assumption underlying the use of composite indicators is that the constituent parts together give a fair summary of the whole

Many composite indicator schemes apply threshold-based classification rules to standardise disparate individual measures to a consistent scale. Measures that are naturally continuous are mapped to categorical bands before being combined into the overall composite

The weighting assigned to individual measures contributing to composites is another problem area. As few hospitals perform equally well in all areas, performance can be artificially improved by giving higher weight to individual measures where a hospital performs better than average and vice versa. The choice of weights given to individual measures is thus a key determinant of performance on the overall composite, and different weights might allow almost any rank to be achieved.31 32 Therefore, transparency is needed about the importance attached to each measure in terms of the aim of the indicator, with supporting evidence. However, many schemes do not provide explicit justification for the weights used to create the composite 

https://www.medrxiv.org/content/10.1101/2020.12.08.20246256v1.full 

https://qualitysafety.bmj.com/content/28/4/338 
 

---
class: left, middle

# Learning objectives

This session is a tutorial to show you how to go through each steps required to do the calculation correctly.

### Stage 0. Prepare data &amp; information
### Stage 1. Review &amp; Process data
### Stage 2. Question the  assumptions
### Stage 3. Visualize Results
 


???
Depending on the pace of the group, if we do not finish today we will org anise a second session 

---

# Webinar rules

&lt;i class="fa fa-spinner fa-spin fa-fw fa-2x"&gt;&lt;/i&gt; Leverage this opportunity and make this session __lively__ - there's no stupid questions!

&lt;i class="fa fa-check-square fa-fw fa-2x"&gt;&lt;/i&gt; Use the __chat__ to send your questions - we are two facilitators and one is focused on replying all questions directly in the chat while the session is on-going

&lt;i class="fa fa-pencil  fa-fw fa-2x"&gt;&lt;/i&gt; No need to take notes, all the session __content__ will be shared 

&lt;i class="fa fa-cog fa-fw fa-2x"&gt;&lt;/i&gt; All practical exercises are designed to get you __testing the commands__:

&gt; Login on a dedicated cloud-based version of RStudio with base packages pre-installed for this session @ 
    
&gt; Paste the command from the chat to your online Rstudio session and check what is happening
    
&gt; In case it is not working as expected, share screenshot or error messages from the console in the chat


---

## Follow the recipe


.pull-left[

In the development area,  there has been long focus to improve the quality of index through methodology nd user guide such as 
[Handbook on Constructing Composite Indicators](https://www.oecd.org/sdd/42495745.pdf), the  [Ten Step Guide](https://knowledge4policy.ec.europa.eu/publication/your-10-step-pocket-guide-composite-indicators-scoreboards_en) &amp; the [pocket Guide](https://knowledge4policy.ec.europa.eu/sites/default/files/10-step-pocket-guide-to-composite-indicators-and-scoreboards.pdf) .  

To bring in the humanitarian world, the same level of statistical quality than in development (aka making the "__nexus__"), the following steps are required: 

 * Treat the data (missing value, outliers)
 * Explore the correlations
 * Standardize/normalize the data
 * Define the weight of each indicator
 * Develop an aggregation method
 * Assess robustness &amp; sensitivity


 
]

 
.pull-right[
 
![Handbook](images/handbook.png)  


]

???

Notes -

---

### The COIN Object

A dedicated package, [COINr](https://bluefoxr.github.io/COINrDoc) has been created by the European Joint Research center to facilitate the creation of composite indicators. it includes __all steps &amp; components__ to support the process.

![tidyverse](images/coinR.png)  



???

Notes -
* `.$Input` is all input data and metadata that was initially used to construct the COIN.
* `.$Data` consists of data frames of indicator data at each construction step, e.g. `.$Data$Raw` is the raw data used to construct the COIN, `.$Data$Normalised` is the same data set after normalisation, and so on.
* `.$Parameters` contains parameters such as sets of weights, details on the number of indicators, aggregation levels, etc.
* `.$Method` is a record of the methodology applied to build the COIN. In practice, this records all the inputs to any COINr functions applied in building the COIN, for example the normalisation method and parameters, data treatment specifications, and so on. Apart from keeping a record of the construction, this also allows the entire results to be regenerated using the information stored in the COIN. This will be explained better in [Adjustments and comparisons].
* `.$Analysis` contains any analysis tables which are sorted by the data sets to which they are applied. This can be e.g. indicator statistics of any of the data sets found in `.$Data`, or correlations.
* `.$Results` contains summary tables of results, arranged and sorted for easy viewing.

 
---
class: inverse, left, middle

# Stage 0. Prepare data &amp; information


 * Document metadata
 * Specify Hierarchy
 * Organise data in tabular format


---

## Indicator data 

.pull-left[

The first thing to notice is that each row is an observation (here, a country), and each column is a variable (mostly indicators, but also other things). Look at the structure of the data frame, working from left to right:

* `UnitName` [**required**] gives the name of each unit. Here, units are countries, so these are the names of each country.
* `UnitCode` [**required**] is a unique code assigned to each unit (country). This is very important, and is the main "reference" inside COINr for units. If your units are countries, I recommend using [ISO Alpha-3 codes](https://en.wikipedia.org/wiki/ISO_3166-1_alpha-3), because these are recognised by COINr for generating maps. It also makes data processing generally easier. For converting names to codes and vice versa, the [countrycode package](https://github.com/vincentarelbundock/countrycode) is extremely handy.
* `Group_*` [optional] Any column name that starts with `Group_` is recognised as a group column rather than an indicator. You don't have to have any groups, but some COINr functions support specific operations on groups (e.g. imputation within group, some charts also recognise groups). You can have as many group columns as you want.
* `Year` [optional] gives the reference year of the data. This allows you to have multiple years of data, for example, you can have a value for a given country for 2018, and another value for the same country for 2019, and so on. Like groups, this feature is not yet fully developed in COINr, but the `assemble()` function has the possibility to select years of data and impute by latest year (see below).
* `Den_*`[optional] Any column names that begin with `Den_*` are recognised as *denominators*, i.e. indicators that are used to scale other indicators. These are used in COINr's `denominate()` function.
* Finally, any column that begins with `x_` will be ignored and passed through. This is not shown in the data set above, but is useful for e.g. alternative codes or other variables that you want to retain. 
 
]

--

.pull-right[
]


???

Notes -


*Any remaining columns that do not begin with `x_` or use the other names in this list are recognised as indicators.*

You will notice that all column (variable/indicator) names use short codes. This is to keep things concise in tables, rough plots etc. Indicator codes should be short, but informative enough that you know which indicator it refers to (e.g. "Ind1" is not so helpful). In some COINr plots, codes are displayed, so you might want to take that into account. In any case, the full names of indicators, and other details, are also specified in the indicator metadata table - see the next section.

Some important rules and tips to keep in mind are:

* The following columns are *required*. All other columns are optional (they can be excluded):
  - UnitCode
  - UnitName (if you don't have separate names you can just replicate the unit codes)
  - At least one indicator column
* Columns don't have to be in any particular order, columns are identified by names rather than positions.
* You can have as many indicators and units as you like.
* Indicator codes and unit codes must have unique names. You can't use the same code twice otherwise bad things will happen.
* Avoid any accented characters or basically any characters outside of English - this can sometimes cause trouble with encoding.
* Column names are case-sensitive. Most things in COINr are built to have a degree of flexibility where possible, but *column names need to be written exactly as they appear here for COINr to recognise them*.,


---

## Document Indicators: 

.pull-left[

Indicator metadata
]

--

.pull-right[
]


???

Notes -


* `IndName` [**required**] This is the full name of the indicator, which will be used in display plots.
* `IndCode`[**required**] A reference code for each indicator. These *must be the same codes as specified in the indicator metadata*. The codes must also be unique.
* `Direction` [**required**] The "direction" of each indicator - this takes values of either 1 or -1 for each indicator. A value of 1 means that higher values of the indicator correspond to higher values of the index, whereas -1 means the opposite.
* `IndWeight` [**required**] The initial weights assigned to each indicator. Weights are relative within each aggregation group and do not need to sum to one (they will be re-scaled to sum to one within each group by COINr).
* `Denominator` [**optional**] These should be the indicator codes of one of the denominator variables for each indicator to be denominated. E.g. here "Den_Pop" specifies that the indicator should be denominated by the "Den_Pop" indicators (population, in this case). For any indicators that do not need denominating, just set `NA`. Denominators can also be specified later, so if you want you can leave this column out. See [Denomination] for more information.
* `IndUnit` [**optional**] The units of the indicator. This helps for keeping track of what the numbers actually mean, and can be used in plots.
* `Target` [**optional**] Targets associated with each indicator. Here, artificial targets have been generated which are 95% of the maximum score (accounting for the direction of the indicator). These are only used if the normalisation method is distance-to-target.
* `Agg*` [**required**] Any column name that begins with `Agg` is recognised as a column specifying the aggregation group, and therefore the structure of the index. Aggregation columns *should be in the order of the aggregation*, but otherwise can have arbitrary names.


---


## Describe dimensions and nested levels: 



.pull-left[
Aggregation metadata
 
]

--

.pull-right[
]

???

Notes -

This data frame simply consists of four columns, all of which are required for assembly:

* `AgLevel` [**required**] The aggregation level (where 1 is indicator level, 2 is the first aggregation level, and so on -- see Section \@ref(Sec:ContructingCIs))
* `Code` [**required**] The aggregation group codes. These codes must match the codes in the corresponding column in the indicator metadata aggregation columns.
* `Name` [**required**] The aggregation group names.
* `Weight` [**required**] The aggregation group weights. These weights can be changed later on if needed.

The codes specified here must be unique and not coincide with any other codes used for defining units or indicators. All columns are required, but do not need to be in a particular order.



---


## Load data and assemble

.pull-left[
To build a composite indicator,  we need three data frames, prepared and assembled in Excel according to a specific format with predefined column name:

1. Indicator data
2. Indicator metadata (_as described previously_)
3. Aggregation metadata (_as described previously_)


```r
library(dplyr)
library(COINr)
library(reactable)
library(magrittr)
# install ggbiplot if you don't have it
# library(devtools)
# install_github("vqv/ggbiplot")
library(ggbiplot)

ASEM &lt;- assemble(IndData = ASEMIndData,
                 IndMeta = ASEMIndMeta,
                 AggMeta = ASEMAggMeta)
```
]

--

.pull-right[

Apart from building the COIN, `assemble()` does a few other things:

* It checks that indicator codes are consistent between indicator data and indicator metadata
* It checks that required columns, such as indicator codes, are present
* It returns some basic information about the data that was input, such as the number of indicators, the number of units, the number of aggregation levels and the groups in each level. This is done so you can check what you have entered, and that it agrees with your expectations.


]

???

Notes -

 

---
class: inverse, left, middle

# Stage 1. Review &amp; Process data

  1. Indicator statistics 
  
  2. Missing data
  
  3. Denominator
  
  4. Outliers
  
  5. Normalisation
  
  6. Aggregation



---

## Check the indicator statistics



.pull-left[
 
It is advisable to do this both on the raw data, and the normalised/aggregated data.
 

Particular things of interest : 
 * whether indicators or aggregates are highly skewed, 
 * the percentage of missing data for each indicator, 
 * the percentage of unique values, low data availability and zeroes, 
 * the presence of correlations with denominators, and negative correlations 
 

```r
# We can change thresholds for flagging outliers and high/low correlations.
ASEM &lt;- getStats(ASEM, dset = "Raw")
# view stats within a table
ASEM$Analysis$Raw$StatTable %&gt;%
  roundDF() %&gt;%
  reactable()
```
 
]

--

.pull-right[

<div id="htmlwidget-f4fa80b06cae51e9469f" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-f4fa80b06cae51e9469f">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Indicator":["Goods","Services","FDI","PRemit","ForPort","CostImpEx"],"Min":[7.23,1.38,0.13,0.17,0,0],"Max":[1919.19,657.11,75.6,30.21,10601.75,992],"Mean":[289.66,128.98,12.53,6.56,1577.42,124.53],"Median":[142.61,54.07,6.1,4.69,259.22,45],"Q.5":[8.86,4.26,0.37,0.39,6.35,0],"Q.25":[44.06,15.74,2.21,1.33,46.98,0],"Q.75":[353.43,199.02,17.15,7.87,1588.93,155.5],"Q.95":[814.12,494.76,44.4,23.62,7260.44,357],"IQ.range":[309.38,183.28,14.94,6.54,1541.95,155.5],"Std.dev":[388.2,161.49,15.79,7.37,2587.11,181.95],"Skew":[2.65,1.7,2.1,1.81,2.02,2.69],"Kurtosis":[8.27,2.38,4.89,2.94,3.3,9.84],"N.missing":[0,0,0,0,3,0],"Prc.complete":[100,100,100,100,94.12,100],"Low.data.flag":["OK","OK","OK","OK","OK","OK"],"Prc.Unique":[1,1,1,1,0.96,0.57],"Frac.Zero":[0,0,0,0,0,0.35],"SK.outlier.flag":["Outliers","OK","Outliers","OK","OK","Outliers"],"Low.Outliers.IQR":[0,0,0,0,0,0],"High.Outliers.IQR":[3,3,4,4,7,2],"Collinearity":["Collinear","OK","OK","OK","OK","OK"],"Neg.Correls":[1,1,1,0,6,16],"Denom.correlation":["High","High","High","High","OK","OK"]},"columns":[{"accessor":"Indicator","name":"Indicator","type":"character"},{"accessor":"Min","name":"Min","type":"numeric"},{"accessor":"Max","name":"Max","type":"numeric"},{"accessor":"Mean","name":"Mean","type":"numeric"},{"accessor":"Median","name":"Median","type":"numeric"},{"accessor":"Q.5","name":"Q.5","type":"numeric"},{"accessor":"Q.25","name":"Q.25","type":"numeric"},{"accessor":"Q.75","name":"Q.75","type":"numeric"},{"accessor":"Q.95","name":"Q.95","type":"numeric"},{"accessor":"IQ.range","name":"IQ.range","type":"numeric"},{"accessor":"Std.dev","name":"Std.dev","type":"numeric"},{"accessor":"Skew","name":"Skew","type":"numeric"},{"accessor":"Kurtosis","name":"Kurtosis","type":"numeric"},{"accessor":"N.missing","name":"N.missing","type":"numeric"},{"accessor":"Prc.complete","name":"Prc.complete","type":"numeric"},{"accessor":"Low.data.flag","name":"Low.data.flag","type":"character"},{"accessor":"Prc.Unique","name":"Prc.Unique","type":"numeric"},{"accessor":"Frac.Zero","name":"Frac.Zero","type":"numeric"},{"accessor":"SK.outlier.flag","name":"SK.outlier.flag","type":"character"},{"accessor":"Low.Outliers.IQR","name":"Low.Outliers.IQR","type":"numeric"},{"accessor":"High.Outliers.IQR","name":"High.Outliers.IQR","type":"numeric"},{"accessor":"Collinearity","name":"Collinearity","type":"character"},{"accessor":"Neg.Correls","name":"Neg.Correls","type":"numeric"},{"accessor":"Denom.correlation","name":"Denom.correlation","type":"character"}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"f45a410740ead75234aca9f76cd2eec6","key":"f45a410740ead75234aca9f76cd2eec6"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>
]



???


Notes - Apart from the overall statistics for each indicator, `getStats` also returns a few other things:

* `.$Outliers`, which flags individual outlying points using the relation to the interquartile range
* `.$Correlations`, which gives a correlation matrix between all indicators in the data set
* `.$DenomCorrelations`, which gives the correlations between indicators and any denominators

At this point you may decide to check individual indicators, and some may be added or excluded.

---

## View missing data by group

.pull-left[


```r
ASEM &lt;- checkData(ASEM, dset = "Raw")

ASEM$Analysis$Raw$MissDatByGroup %&gt;%
  roundDF %&gt;%
  reactable::reactable()
```
]

--

.pull-right[
<div id="htmlwidget-de6e874a84f330101707" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-de6e874a84f330101707">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"UnitCode":["AUT","BEL","BGR","HRV","CYP","CZE"],"ConEcFin":[100,100,100,100,100,100],"Instit":[100,100,100,100,100,100],"P2P":[100,100,100,100,100,100],"Physical":[100,100,100,100,100,100],"Political":[100,100,100,100,100,100],"Environ":[100,100,100,100,100,100],"Social":[100,100,100,100,100,100],"SusEcFin":[100,100,100,100,100,100],"Conn":[100,100,100,100,100,100],"Sust":[100,100,100,100,100,100],"Index":[100,100,100,100,100,100]},"columns":[{"accessor":"UnitCode","name":"UnitCode","type":"character"},{"accessor":"ConEcFin","name":"ConEcFin","type":"numeric"},{"accessor":"Instit","name":"Instit","type":"numeric"},{"accessor":"P2P","name":"P2P","type":"numeric"},{"accessor":"Physical","name":"Physical","type":"numeric"},{"accessor":"Political","name":"Political","type":"numeric"},{"accessor":"Environ","name":"Environ","type":"numeric"},{"accessor":"Social","name":"Social","type":"numeric"},{"accessor":"SusEcFin","name":"SusEcFin","type":"numeric"},{"accessor":"Conn","name":"Conn","type":"numeric"},{"accessor":"Sust","name":"Sust","type":"numeric"},{"accessor":"Index","name":"Index","type":"numeric"}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"90a0369dea614a7b30d69b0d0b01d744","key":"90a0369dea614a7b30d69b0d0b01d744"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>

]



???

Notes -  

--- 
class: inverse, left, middle

## Treat &amp; Process data



??? 

--- 

## Add Denomination 



.pull-left[
 

To be able to compare small countries with larger ones, you may need to divide indicators by e.g. GDP or population , you can use `denominate()`. The specifications are either made initially in `IndMeta`, or as arguments to `denominate()`. In the case of the ASEM data set, these are included in `IndMeta` so the command is very simple (run `View(ASEMIndMeta)` to see). We will afterwards check the new stats to see what has changed. 



```r
# create denominated data set
ASEM &lt;- denominate(ASEM, dset = "Raw")

# get stats of denominated data
ASEM &lt;- getStats(ASEM, dset = "Denominated")

# view stats table
ASEM$Analysis$Raw$StatTable %&gt;%
  roundDF() %&gt;%
  reactable()
```

]

--

.pull-right[



<div id="htmlwidget-91195e52a788f0c02ac9" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-91195e52a788f0c02ac9">{"x":{"tag":{"name":"Reactable","attribs":{"data":{"Indicator":["Goods","Services","FDI","PRemit","ForPort","CostImpEx","Tariff","TBTs","TIRcon","RTAs","Visa","StMob","Research","Pat","CultServ","CultGood","Tourist","MigStock","Lang","LPI","Flights","Ship","Bord","Elec","Gas","ConSpeed","Cov4G","Embs","IGOs","UNVote","Renew","PrimEner","CO2","MatCon","Forest","Poverty","Palma","TertGrad","FreePress","TolMin","NGOs","CPI","FemLab","WomParl","PubDebt","PrivDebt","GDPGrow","RDExp","NEET"],"Min":[7.23,1.38,0.13,0.17,0,0,0,1,0,1,1,1.77,175,0.3,0,0.05,0.12,0.08,0.02,2.07,0.99,0,0,0,0.01,5.5,0,28,82,35.76,0.01,53.48,0.3,2.58,0.33,0,0.88,2.01,8,1.1,0,21,0.3,4.86,2.81,19.67,-0.68,0.08,0.6],"Max":[1919.19,657.11,75.6,30.21,10601.75,992,10.53,1754,1,46,92,445,96337,2771.7,9.57,74.47,82.57,10.93,21.49,4.23,210.82,21.17,122,110.18,94.8,28.6,100,100,329,43.19,64.92,192.45,22.12,38.38,31.85,22.7,2.62,37.6,87,9.8,1824,89,1.03,43.55,247.98,421.39,7.58,4.23,42.1],"Mean":[289.66,128.98,12.53,6.56,1577.42,124.53,2.46,794.84,0.75,23.92,69.18,64.08,16340.33,333.58,1.45,10,15.06,2.48,9.31,3.41,38.62,11.98,23.61,16.23,10.03,14.29,75.64,70.86,198.22,40.91,22.66,106.08,6.71,16.02,5.95,2.44,1.34,21.95,38.43,5.39,220.49,57.37,0.82,24.4,62.95,140.48,3.22,1.5,12.59],"Median":[142.61,54.07,6.1,4.69,259.22,45,1.6,1140.5,1,30,79,33.2,7731,112.6,0.58,3.3,9.2,1.4,9.1,3.42,25.65,12.69,18,6.91,1.14,14.6,91,75,197,42.52,17.17,96.63,5.94,15.02,4.98,0.4,1.25,23.35,28,5.1,66,57,0.86,23.7,52.09,128.46,3.53,1.29,10.9],"Q.5":[8.86,4.26,0.37,0.39,6.35,0,0.68,2.45,0,6.5,17,4.02,296,3.82,0.02,0.39,0.69,0.16,0.06,2.54,2.05,0,0,0,0.03,6.93,4.5,40.5,91,37.03,2.13,59.53,0.45,4.2,1.21,0,0.89,8.52,11.5,2,1,29,0.57,9.66,18.68,24.8,0,0.14,4],"Q.25":[44.06,15.74,2.21,1.33,46.98,0,1.6,117.25,0.5,17,61,13.55,1724,23.7,0.13,1.21,3.17,0.62,4.78,2.99,6.77,9.09,8.5,1.2,0.38,10.95,65.25,52,163.5,38.55,9.13,78.39,4.29,11,2.68,0,1.1,16.84,20.5,3.6,22.5,40.5,0.8,18.1,34.83,76.31,1.5,0.7,7],"Q.75":[353.43,199.02,17.15,7.87,1588.93,155.5,1.86,1185,1,30,81,69.55,20205,437.6,1.89,11.8,17.36,4.05,14.15,3.81,46.13,16.8,32,22.92,12.6,16.9,98.35,85,234,42.75,33.78,128.52,8.78,18.78,6.56,1.1,1.48,28.38,55.5,6.8,187.5,75,0.9,30.78,82.03,189.72,4.9,2.2,15.3],"Q.95":[814.12,494.76,44.4,23.62,7260.44,357,9.04,1389.4,1,30.5,87.5,250.5,67515,1315.3,6.36,40.14,55.82,8.05,19.31,4.2,142.58,20.56,68.5,59.05,39.3,22.42,100,100,286.5,43.1,58.54,172.64,15.11,33.17,15.24,17.91,2.08,34.1,84.5,8.45,1028.5,85,0.95,39.39,131.03,277.94,6.23,3.21,27.7],"IQ.range":[309.38,183.28,14.94,6.54,1541.95,155.5,0.26,1067.75,0.5,13,20,56,18481,413.9,1.77,10.58,14.19,3.43,9.36,0.82,39.36,7.71,23.5,21.72,12.22,5.95,33.1,33,70.5,4.2,24.65,50.13,4.49,7.78,3.88,1.1,0.38,11.54,35,3.2,165,34.5,0.1,12.68,47.2,113.41,3.4,1.5,8.3],"Std.dev":[388.2,161.49,15.79,7.37,2587.11,181.95,2.38,550.4,0.44,9.38,22.17,86.55,23136.9,526.71,2.09,15.02,18.36,2.53,6.35,0.54,46.72,6.84,24.82,22.67,17.51,5.11,32.15,20.06,58.63,2.38,17.2,35.45,4.55,8.21,5.63,5.51,0.37,8.52,24.42,2.15,387.49,19.8,0.14,9.72,43.65,84.89,2.04,1.02,7.74],"Skew":[2.65,1.7,2.1,1.81,2.02,2.69,2.45,-0.4,-1.16,-0.68,-1.76,2.73,2.22,2.85,2.47,2.61,2.19,1.54,0.09,-0.3,2.1,-0.58,2.15,2.23,2.83,0.46,-1.37,-0.37,-0.06,-0.68,0.82,0.75,1.11,0.76,2.71,2.92,1.33,-0.38,0.75,0.06,2.79,0.02,-2.06,0.09,2,0.96,-0.05,0.61,1.6],"Kurtosis":[8.27,2.38,4.89,2.94,3.3,9.84,5.41,-1.55,-0.68,0.13,2.17,8.31,4.81,10.06,6.39,7.74,4.9,2.06,-1.08,-0.66,4.51,-0.68,5.79,5.79,10.33,0.19,0.54,-0.99,-0.25,-1.2,-0.07,-0.15,1.83,0.42,9.35,7.88,2.3,-0.3,-0.78,-0.66,7.92,-1.25,5.02,-0.79,5.97,1.43,-0.93,-0.28,3.63],"N.missing":[0,0,0,0,3,0,3,1,0,0,0,0,0,6,4,7,0,0,0,0,0,0,0,0,0,8,0,0,0,0,0,1,0,0,0,7,6,7,0,0,0,0,2,0,1,1,0,4,2],"Prc.complete":[100,100,100,100,94.12,100,94.12,98.04,100,100,100,100,100,88.24,92.16,86.27,100,100,100,100,100,100,100,100,100,84.31,100,100,100,100,100,98.04,100,100,100,86.27,88.24,86.27,100,100,100,100,96.08,100,98.04,98.04,100,92.16,96.08],"Low.data.flag":["OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK"],"Prc.Unique":[1,1,1,1,0.96,0.57,0.41,0.84,0.04,0.27,0.43,0.98,1,0.9,0.94,0.88,1,1,1,1,1,0.84,0.59,0.9,1,0.8,0.73,0.65,0.9,0.96,1,1,1,1,1,0.35,0.71,0.88,0.75,0.78,0.92,0.76,0.98,0.96,1,1,0.98,0.94,0.8],"Frac.Zero":[0,0,0,0,0,0.35,0.04,0,0.25,0,0,0,0,0,0,0,0,0,0,0,0,0.18,0.12,0.08,0,0,0.04,0,0,0,0,0,0,0,0,0.27,0,0,0,0,0.02,0,0,0,0,0,0.04,0,0],"SK.outlier.flag":["Outliers","OK","Outliers","OK","OK","Outliers","Outliers","OK","OK","OK","OK","Outliers","Outliers","Outliers","Outliers","Outliers","Outliers","OK","OK","OK","Outliers","OK","Outliers","Outliers","Outliers","OK","OK","OK","OK","OK","OK","OK","OK","OK","Outliers","Outliers","OK","OK","OK","OK","Outliers","OK","Outliers","OK","OK","OK","OK","OK","OK"],"Low.Outliers.IQR":[0,0,0,0,0,0,5,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0],"High.Outliers.IQR":[3,3,4,4,7,2,12,0,0,0,0,4,4,4,4,5,4,1,0,0,5,0,3,3,5,1,0,0,0,0,0,0,2,4,5,7,3,0,0,0,7,0,0,0,2,1,0,0,3],"Collinearity":["Collinear","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","Collinear","OK","OK","Collinear","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK"],"Neg.Correls":[1,1,1,0,6,16,15,7,5,9,9,2,0,1,2,0,0,4,9,9,1,0,1,6,1,6,9,0,7,11,10,8,6,6,1,17,14,10,18,18,2,9,6,5,1,8,18,7,19],"Denom.correlation":["High","High","High","High","OK","OK","OK","OK","OK","OK","OK","High","High","OK","OK","High","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK","OK"]},"columns":[{"accessor":"Indicator","name":"Indicator","type":"character"},{"accessor":"Min","name":"Min","type":"numeric"},{"accessor":"Max","name":"Max","type":"numeric"},{"accessor":"Mean","name":"Mean","type":"numeric"},{"accessor":"Median","name":"Median","type":"numeric"},{"accessor":"Q.5","name":"Q.5","type":"numeric"},{"accessor":"Q.25","name":"Q.25","type":"numeric"},{"accessor":"Q.75","name":"Q.75","type":"numeric"},{"accessor":"Q.95","name":"Q.95","type":"numeric"},{"accessor":"IQ.range","name":"IQ.range","type":"numeric"},{"accessor":"Std.dev","name":"Std.dev","type":"numeric"},{"accessor":"Skew","name":"Skew","type":"numeric"},{"accessor":"Kurtosis","name":"Kurtosis","type":"numeric"},{"accessor":"N.missing","name":"N.missing","type":"numeric"},{"accessor":"Prc.complete","name":"Prc.complete","type":"numeric"},{"accessor":"Low.data.flag","name":"Low.data.flag","type":"character"},{"accessor":"Prc.Unique","name":"Prc.Unique","type":"numeric"},{"accessor":"Frac.Zero","name":"Frac.Zero","type":"numeric"},{"accessor":"SK.outlier.flag","name":"SK.outlier.flag","type":"character"},{"accessor":"Low.Outliers.IQR","name":"Low.Outliers.IQR","type":"numeric"},{"accessor":"High.Outliers.IQR","name":"High.Outliers.IQR","type":"numeric"},{"accessor":"Collinearity","name":"Collinearity","type":"character"},{"accessor":"Neg.Correls","name":"Neg.Correls","type":"numeric"},{"accessor":"Denom.correlation","name":"Denom.correlation","type":"character"}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"94cc0f0b4a0ac9f299fe895f018c08b6","key":"94cc0f0b4a0ac9f299fe895f018c08b6"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>

]


???

Notes -According to the new table, there are now no high correlations with denominators, which indicates some kind of success.

---


## Treat the data for outliers



.pull-left[
 

Standard approach which Winsorises each indicator up to a specified limit of points, in order to bring skew and kurtosis below specified thresholds. If Winsorisation fails, it applies a log transformation or similar.Following treatment, it is a good idea to check which indicators were treated and how:


```r
ASEM &lt;- treat(ASEM, 
              dset = "Denominated", 
              winmax = 5)
ASEM$Analysis$Treated$TreatSummary %&gt;%
  filter(Treatment != "None") %&gt;%
  reactable()
```
]

--

.pull-right[
 
<div id="htmlwidget-3a6c18fdacf57ab01955" class="reactable html-widget" style="width:auto;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-3a6c18fdacf57ab01955">{"x":{"tag":{"name":"Reactable","attribs":{"data":{".rownames":["V2","V3","V5","V6","V7","V12"],"IndCode":["Services","FDI","ForPort","CostImpEx","Tariff","StMob"],"Low":[0,0,0,0,0,0],"High":[4,2,3,1,3,2],"TreatSpec":["Default, winmax = 5","Default, winmax = 5","Default, winmax = 5","Default, winmax = 5","Default, winmax = 5","Default, winmax = 5"],"Treatment":["Winsorised 4 points","Winsorised 2 points","Winsorised 3 points","Winsorised 1 points","Winsorised 3 points","Winsorised 2 points"]},"columns":[{"accessor":".rownames","name":"","type":"character","sortable":false,"filterable":false},{"accessor":"IndCode","name":"IndCode","type":"character"},{"accessor":"Low","name":"Low","type":"numeric"},{"accessor":"High","name":"High","type":"numeric"},{"accessor":"TreatSpec","name":"TreatSpec","type":"character"},{"accessor":"Treatment","name":"Treatment","type":"character"}],"defaultPageSize":10,"paginationType":"numbers","showPageInfo":true,"minRows":1,"dataKey":"3a7358c2b8d9a67299d7dbb0be9be1c6","key":"3a7358c2b8d9a67299d7dbb0be9be1c6"},"children":[]},"class":"reactR_markup"},"evals":[],"jsHooks":[]}</script>


]




???

Notes -

---


## Visualise effect of data treatment



.left-column[
 
Effect of the Winsorisation can be plotted using box plots or violin plots. 


```r
COINr::iplotIndDist2(ASEM, 
  dsets = c("Denominated", "Treated"), 
  icodes = "Services", 
  ptype = "Scatter")
```
]

--

.right-column[


<div id="htmlwidget-f4fa80b06cae51e9469f" style="width:750px;height:463.5px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-f4fa80b06cae51e9469f">{"x":{"visdat":{"44fa29302f0a":["function () ","plotlyVisDat"]},"cur_data":"44fa29302f0a","attrs":{"44fa29302f0a":{"mode":"markers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"44fa29302f0a.1":{"mode":"markers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","x":{},"y":{},"text":["Austria","Belgium","Bulgaria","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Ireland","Italy","Latvia","Lithuania","Luxembourg","Malta","Netherlands","Norway","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden","Switzerland","United Kingdom","Australia","Bangladesh","Brunei Darussalam","Cambodia","China","India","Indonesia","Japan","Kazakhstan","Korea","Lao PDR","Malaysia","Mongolia","Myanmar","New Zealand","Pakistan","Philippines","Russian Federation","Singapore","Thailand","Vietnam"],"hoverinfo":"text","marker":{"size":15},"showlegend":false,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"Trade in services <br> (Million USD)"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Trade in services <br> (Million USD)"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"mode":"markers","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"markers","type":"scatter","x":[0.276681940794445,0.462254867226653,0.243742052901564,0.338794072256007,0.760098867666084,0.222543207322299,0.370398919453455,0.438248128135714,0.225605264893292,0.191158749982344,0.166319805540168,0.198135393098302,0.310924849651287,1.10917783352835,0.108956030826193,0.263149434041176,0.288904481310413,2.82768641582263,1.82464239937715,0.445881137056196,0.224642950519038,0.175530424570937,0.213728847524469,0.166318536379482,0.180966399813671,0.263728015550315,0.15938355214756,0.256778035747555,0.310029600268569,0.195712022067552,0.0833020877198363,0.0456396445810669,0.185490394414346,0.289391165863444,0.058574838537451,0.13023397074421,0.0579954816204536,0.0711933183269379,0.124883704482977,0.142319736141744,0.0872184959616381,0.245944958634483,0.243897222607497,0.0949810719669238,0.141592261176336,0.0389460389950171,0.181091173647035,0.0983541886685242,1.02616844245993,0.265365886247069,0.148738354805822],"y":[0.276681940794445,0.462254867226653,0.243742052901564,0.338794072256007,0.760098867666084,0.222543207322299,0.370398919453455,0.438248128135714,0.225605264893292,0.191158749982344,0.166319805540168,0.198135393098302,0.310924849651287,0.760098867666084,0.108956030826193,0.263149434041176,0.288904481310413,0.760098867666084,0.760098867666084,0.445881137056196,0.224642950519038,0.175530424570937,0.213728847524469,0.166318536379482,0.180966399813671,0.263728015550315,0.15938355214756,0.256778035747555,0.310029600268569,0.195712022067552,0.0833020877198363,0.0456396445810669,0.185490394414346,0.289391165863444,0.058574838537451,0.13023397074421,0.0579954816204536,0.0711933183269379,0.124883704482977,0.142319736141744,0.0872184959616381,0.245944958634483,0.243897222607497,0.0949810719669238,0.141592261176336,0.0389460389950171,0.181091173647035,0.0983541886685242,0.760098867666084,0.265365886247069,0.148738354805822],"text":["Austria","Belgium","Bulgaria","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Ireland","Italy","Latvia","Lithuania","Luxembourg","Malta","Netherlands","Norway","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden","Switzerland","United Kingdom","Australia","Bangladesh","Brunei Darussalam","Cambodia","China","India","Indonesia","Japan","Kazakhstan","Korea","Lao PDR","Malaysia","Mongolia","Myanmar","New Zealand","Pakistan","Philippines","Russian Federation","Singapore","Thailand","Vietnam"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"marker":{"color":"rgba(255,127,14,1)","size":15,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

]


???

Notes -It is also a good idea to visualise and compare the treated data against the untreated data. The best way to do this interactively is to call `indDash()` again, which allows comparison of treated and untreated indicators side by side. 

---


## Normalise the data

Normalisation is the operation of bringing indicators onto comparable scales so that they can be aggregated more fairly

.pull-left[
 

The next step would be to normalise the data. In the ASEM index we will use a simple min-max normalisation in the `\([0, 100]\)` interval. 

* `ntype = "minmax"` yields a min-max transformation that scales each indicator onto an interval specified by `npara`, e.g. if `npara$minmax = c(0,10)` the indicators will scale to [0, 10].
* `ntype = "zscore"` scales the indicator to have a mean and standard deviation specified by `npara`, e.g. if `npara$zscore = c(0,1)` the indicator will have mean zero and standard deviation 1.
* `ntype = "scaled"` is a general linear transformation defined by `npara$scaled = c(a,b)` which subtracts `a` and divides by `b`.
* `ntype = "goalposts"` is a capped linear transformation (see the "goalposts" method mentioned previously). Here `npara$goalposts = c(l, u, a)`, where `l` is the lower bound, `u` is the upper bound, and `a` is a scaling parameter.
* `ntype = "rank"` replaces indicator scores with their corresponding ranks, such that the highest scores have the largest rank values. Ties take average rank values. Here `npara` is not used.
* `ntype = "borda"` is similar to `ntype = "rank"` but uses Borda scores, which are simply rank values minus one. `npara` is not used.
* `ntype = "prank"` gives percentile ranks. `npara` is not used.
* `ntype = "fracmax"` scales each indicator by dividing the value by the maximum value of the indicator. `npara` is not used.
* `ntype = "dist2ref"` gives the distance to a reference unit, defined by `npara`. For example, if `npara$dist2ref = "AUT"` then all scores will be normalised as the distance to the score of unit "AUT" in each indicator (divided by the range of the indicator). This is useful for benchmarking against a set unit, e.g. a reference country. Scores
* `ntype = "dist2max"` gives the normalised distance to the maximum of each indicator.
* `ntype = "dist2targ"` gives the normalised distance to indicator targets. Targets are specified, in the `IndMeta` argument of `assemble()`, and will be in the COIN at `.$Input$IndMeta`. Any scores that exceed the target will be capped at a normalised value of one.
* `ntype = "custom"` allows to pass a custom function to apply to every indicator. For example, `npara$custom = function(x) {x/max(x, na.rm = T)}` would give the "fracmax" normalisation method described above.
* `ntype = "none"` the indicator is not normalised (this is mainly useful for adjustments and sensitivity analysis).

]

--

.pull-right[


```r
ASEM &lt;- normalise(ASEM, 
                  dset = "Treated", 
                  ntype = "minmax", 
                  npara = list(minmax = c(0,100)))
```

]


???

Notes -Again, we could visualise and check stats here but to keep things shorter we'll skip that for now.

---


## Aggregation of all indicators: which method to use?



.pull-left[
 
Aggregation type can be:
 * `arith_mean` The most straightforward and widely-used approach to aggregation is the **weighted arithmetic mean**.
 
 * `geom_mean` the **weighted geometric mean** uses the product of the indicators rather than the sum

 * `harm_mean` The [Pythagorean means](https://en.wikipedia.org/wiki/Pythagorean_means) also called **weighted harmonic mean**,  uses the mean of the reciprocals of the indicators. It is the the least compensatory of the the three means, even less so than the geometric mean. It is often used for taking the mean of rates and ratios.

  * `median` The *weighted median* is defined by ordering indicator values, then picking the value which has half of the assigned weight above it, and half below it.

 * `copeland` The [Copeland method](https://en.wikipedia.org/wiki/Copeland%27s_method) is based pairwise comparisons between units, calculated from an *outranking matrix* 
]

--

.pull-right[

```r
ASEM &lt;- aggregate(ASEM, 
                  agtype = "arith_mean", 
                  dset = "Normalised")
```
]
 


???

Notes -

---
class: inverse, left, middle

# Stage 2. Question the  assumptions


* Correlations between indicators,  with parents pillars,  within and between pillars
* Internal Consistency
* Principle component
* Effect of specific formulation
* Sensitivity Analysis

???

correlation structure between the underlying indicators and its effect on the overall score (i.e., the CI). Ideally, there should be positive correlations between the indicators as this indicates that individual variables are linked to an overarching concept


---

## Reconstruct the index from raw data 



.pull-left[

to check differences, Check calculations for pre-aggregated data to make sure that they are correct. If you only have normalised and aggregated data, you can still at least check the aggregation stage as follows. Assuming that the indicator columns in your pre-aggregated data are normalised, we can first manually create a normalised data set: 
]

--

.pull-right[



```r
# extract aggregated data set (as a data frame)
Aggregated_Data &lt;- ASEM$Data$Aggregated

# assemble new COIN only including pre-aggregated data
ASEM_preagg &lt;- assemble(IndData = Aggregated_Data,
                        IndMeta = ASEMIndMeta,
                        AggMeta = ASEMAggMeta,
                        preagg = TRUE)
```


```r
ASEM_preagg$Data$Normalised &lt;- ASEM_preagg$Data$PreAggregated %&gt;%
  select(!ASEM$Input$AggMeta$Code)
```

Here we have just copied the pre-aggregated data, but removed any aggregation columns.

Next, we can aggregate these columns using COINr.


```r
ASEM_preagg &lt;- aggregate(ASEM_preagg, 
                         dset = "Normalised", 
                         agtype = "arith_mean")

# check data set names
names(ASEM_preagg$Data)
```

```
## [1] "PreAggregated" "Normalised"    "Aggregated"
```

]

???

Notes - COINr will check that the column names in the indicator data correspond to the codes supplied in the `IndMeta` and `AggMeta`. This means that these two latter data frames still need to be supplied. However, from this point the COIN functions as any other, although consider that it cannot be regenerated (the methodology to arrive at the pre-aggregated data is unknown), and the only data set present is the "PreAggregated" data.

---

## Check whether  data frames are the same 



.pull-left[
 

Double-checking calculations is tedious but in the process you often learn a lot.  
]

--

.pull-right[


```r
all_equal(ASEM_preagg$Data$PreAggregated,
          ASEM_preagg$Data$Aggregated)
```

```
## [1] TRUE
```

]


???

Notes - As expected, here the results are the same. If the results are *not* the same, `all_equal()` will give some information about the differences. If you reconstruct the index from raw data, and you find differences, a few points are worth considering:

1. The difference could be due to an error in the pre-aggregated data, or even a bug in COINr. If you suspect the latter please open an issue on the repo.
2. If you have used data treatment or imputation, differences can easily arise. One reason is that some things are possible to calculate in different ways. COINr uses certain choices, but other choices are also valid. Examples of this include:
    - Skew and kurtosis (underlying data treatment) - see e.g. `?e1071::skewness`
    - Correlation and treatment of missing values - see `?cor`
    - Ranks and how to handle ties - see `?rank`
3. Errors can also arise from how you entered the data. Worth re-checking all that as well.



---



## Revise internal consistency 

Cronbach's alpha calculation should be done for any group of indicators 

```r
# all indicators
getCronbach(ASEM, dset = "Normalised")
```

```
## [1] 0.9005396
```

```r
# indicators in connectivity sub-index
getCronbach(ASEM, dset = "Normalised", icodes = "Conn", aglev = 1)
```

```
## [1] 0.8799702
```

```r
# indicators in sustainability sub-index
getCronbach(ASEM, dset = "Normalised", icodes = "Sust", aglev = 1)
```

```
## [1] 0.6842895
```

```r
# pillars in connectivity sub-index
getCronbach(ASEM, dset = "Aggregated", icodes = "Conn", aglev = 2)
```

```
## [1] 0.7737003
```

```r
# pillars in sustainability sub-index
getCronbach(ASEM, dset = "Aggregated", icodes = "Sust", aglev = 2)
```

```
## [1] -0.3461489
```
???

Notes -Recall here that because we have plotted a "Raw" indicator against the index, and this is a negative indicator, its direction is flipped. Meaning that in this plot there is a positive correlation, but plotting the normalised indicator against the index would show a negative correlation.

---


## Correlation analysis on the normalised data 



.left-column[
 

As indicators have had their directions reversed where appropriate, how the consistency of the sustainability pillars is then affected? 


```r
COINr::plotCorr(ASEM, 
        dset = "Aggregated", 
        icodes = "Sust", 
        aglevs = 2, 
        pval = 0)
```
]

--

.right-column[


&lt;img src="TrainingSeverityIndex_files/figure-html/unnamed-chunk-20-1.png" width="1200" /&gt;

]
 

???

Notes - 
Sustainability dimensions are not well-correlated and are in fact slightly negatively correlated. This points to trade-offs between different aspects of sustainable development: as social sustainability increases, environmental sustainability often tends to decrease. Or at best, an increase in one does not really imply an increase in the others.

---


## Principle component analysis 

This can be done only on data without missing value


```r
# impute one
ASEM2 &lt;- impute(ASEM, dset = "Denominated", imtype = "indgroup_mean", groupvar = "Group_GDP")
ASEM2 &lt;- normalise(ASEM2, dset = "Treated", ntype = "minmax", npara = list(minmax = c(0,100)))
# try here at the indicator level, let's say within one of the pillar groups:
PCA_P2P &lt;- getPCA(ASEM2, dset = "Normalised", 
                  icodes = "P2P", 
                  aglev = 1, 
                  out2 = "list")

summary(PCA_P2P$PCAresults$P2P$PCAres)
```

```
## Importance of components:
##                           PC1    PC2    PC3     PC4     PC5     PC6     PC7
## Standard deviation     1.9251 1.0797 0.9485 0.86979 0.77992 0.63344 0.49754
## Proportion of Variance 0.4633 0.1457 0.1125 0.09457 0.07603 0.05016 0.03094
## Cumulative Proportion  0.4633 0.6090 0.7214 0.81600 0.89203 0.94219 0.97313
##                            PC8
## Standard deviation     0.46362
## Proportion of Variance 0.02687
## Cumulative Proportion  1.00000
```




```r
# ggbiplot(PCA_P2P$PCAresults$P2P$PCAres,
#          labels = ASEM$Data$Normalised$UnitCode,
#          groups = ASEM$Data$Normalised$Group_EurAsia)
```


???

Notes - We can see that the first principle component explains about 50% of the variance of the indicators, which is perhaps borderline for the existence of single latent variable. That said, many composite indicators will not yield strong latent variables in many cases.

We can now produce a PCA biplot using this information.
Once again we see a fairly clear divide between Asia and Europe in terms of P2P connectivity, with exceptions of Singapore which is very well-connected. We also note the small cluster of New Zealand and Australia which have very similar characteristics in P2P connectivity.

---


## Understand the effective weights of each indicator

A sometimes under-appreciated fact is that the weight of an indicator in the final index is due to its own weight, plus the weight of all its parents, as well as the number of indicators and aggregates in each group. 
.left-column[

For example, an equally-weighted group of two indicators will each have a higher weight (0.5) than an equally weighted group of ten indicators (0.1), and this applies to all aggregation levels.


```r
#  `effectiveWeight()` gives effective weights for all levels. We can check the indicator level by filtering:
EffWts &lt;- effectiveWeight(ASEM)
# Filter the maximum and minimum effective weights and which indicators are involved:
# IndWts &lt;- EffWts$EffectiveWeightsList %&gt;%
#   filter(AgLevel == 1) %&gt;%
#   filter(EffectiveWeight %in% c(min(IndWts$EffectiveWeight), max(IndWts$EffectiveWeight)))

COINr::plotframework(ASEM)
```
 
]

--

.right-column[

<div id="htmlwidget-f4fa80b06cae51e9469f" style="width:900px;height:556.2px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-f4fa80b06cae51e9469f">{"x":{"visdat":{"44717daf597d":["function () ","plotlyVisDat"]},"cur_data":"44717daf597d","attrs":{"44717daf597d":{"labels":["Goods","Services","FDI","PRemit","ForPort","CostImpEx","Tariff","TBTs","TIRcon","RTAs","Visa","StMob","Research","Pat","CultServ","CultGood","Tourist","MigStock","Lang","LPI","Flights","Ship","Bord","Elec","Gas","ConSpeed","Cov4G","Embs","IGOs","UNVote","Renew","PrimEner","CO2","MatCon","Forest","Poverty","Palma","TertGrad","FreePress","TolMin","NGOs","CPI","FemLab","WomParl","PubDebt","PrivDebt","GDPGrow","RDExp","NEET","ConEcFin","Instit","P2P","Physical","Political","Environ","Social","SusEcFin","Conn","Sust","Index"],"parents":["ConEcFin","ConEcFin","ConEcFin","ConEcFin","ConEcFin","Instit","Instit","Instit","Instit","Instit","Instit","P2P","P2P","P2P","P2P","P2P","P2P","P2P","P2P","Physical","Physical","Physical","Physical","Physical","Physical","Physical","Physical","Political","Political","Political","Environ","Environ","Environ","Environ","Environ","Social","Social","Social","Social","Social","Social","Social","Social","Social","SusEcFin","SusEcFin","SusEcFin","SusEcFin","SusEcFin","Conn","Conn","Conn","Conn","Conn","Sust","Sust","Sust","Index","Index",""],"values":[0.02,0.02,0.02,0.02,0.02,0.0166666666666667,0.0166666666666667,0.0166666666666667,0.0166666666666667,0.0166666666666667,0.0166666666666667,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.1,0.1,0.1,0.1,0.1,0.166666666666667,0.166666666666667,0.166666666666667,0.5,0.5,1],"branchvalues":"total","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"sunburst"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"labels":["Goods","Services","FDI","PRemit","ForPort","CostImpEx","Tariff","TBTs","TIRcon","RTAs","Visa","StMob","Research","Pat","CultServ","CultGood","Tourist","MigStock","Lang","LPI","Flights","Ship","Bord","Elec","Gas","ConSpeed","Cov4G","Embs","IGOs","UNVote","Renew","PrimEner","CO2","MatCon","Forest","Poverty","Palma","TertGrad","FreePress","TolMin","NGOs","CPI","FemLab","WomParl","PubDebt","PrivDebt","GDPGrow","RDExp","NEET","ConEcFin","Instit","P2P","Physical","Political","Environ","Social","SusEcFin","Conn","Sust","Index"],"parents":["ConEcFin","ConEcFin","ConEcFin","ConEcFin","ConEcFin","Instit","Instit","Instit","Instit","Instit","Instit","P2P","P2P","P2P","P2P","P2P","P2P","P2P","P2P","Physical","Physical","Physical","Physical","Physical","Physical","Physical","Physical","Political","Political","Political","Environ","Environ","Environ","Environ","Environ","Social","Social","Social","Social","Social","Social","Social","Social","Social","SusEcFin","SusEcFin","SusEcFin","SusEcFin","SusEcFin","Conn","Conn","Conn","Conn","Conn","Sust","Sust","Sust","Index","Index",""],"values":[0.02,0.02,0.02,0.02,0.02,0.0166666666666667,0.0166666666666667,0.0166666666666667,0.0166666666666667,0.0166666666666667,0.0166666666666667,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0125,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0185185185185185,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.0333333333333333,0.1,0.1,0.1,0.1,0.1,0.166666666666667,0.166666666666667,0.166666666666667,0.5,0.5,1],"branchvalues":"total","type":"sunburst","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(255,255,255,1)"}},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
]



???

Notes -

---


## What-ifs: Effect of  formulation on scores &amp; ranks 

Examples could include different weights, as well as adding/removing/substituting indicators or entire aggregation groups



```r
# Copy the COIN
ASEM_NoPolitical &lt;- ASEM

# Copy the weights
ASEM_NoPolitical$Parameters$Weights$NoPolitical &lt;- ASEM_NoPolitical$Parameters$Weights$Original

# Set Political weight to zero
ASEM_NoPolitical$Parameters$Weights$NoPolitical$Weight[
  ASEM_NoPolitical$Parameters$Weights$NoPolitical$Code == "Political"] &lt;- 0

# Alter methodology to use new weights
ASEM_NoPolitical$Method$aggregate$agweights &lt;- "NoPolitical"

# Regenerate
ASEM_NoPolitical &lt;- regen(ASEM_NoPolitical)
```

Now we need to compare the two alternative indexes:


```r
COINr::compTable(ASEM, ASEM_NoPolitical, dset = "Aggregated", isel = "Index",
          COINnames = c("Original", "NoPolitical"))
```

```
##    UnitCode           UnitName Rank: Original Rank: NoPolitical RankChange
## 6       BRN  Brunei Darussalam             38                45         -7
## 14      EST            Estonia             21                28         -7
## 13      ESP              Spain             24                18          6
## 44      ROU            Romania             25                20          5
## 9       CYP             Cyprus             29                33         -4
## 21      IDN          Indonesia             44                40          4
## 8       CHN              China             49                46          3
## 19      HRV            Croatia             18                21         -3
## 20      HUN            Hungary             20                23         -3
## 25      JPN              Japan             34                31          3
## 31      LUX         Luxembourg              8                11         -3
## 33      MLT              Malta             12                15         -3
## 50      THA           Thailand             41                38          3
## 10      CZE     Czech Republic             17                19         -2
## 11      DEU            Germany              9                 7          2
## 12      DNK            Denmark              3                 5         -2
## 15      FIN            Finland             14                12          2
## 16      FRA             France             19                17          2
## 23      IRL            Ireland             11                 9          2
## 26      KAZ         Kazakhstan             47                49         -2
## 28      KOR              Korea             31                29          2
## 29      LAO            Lao PDR             45                47         -2
## 32      LVA             Latvia             23                25         -2
## 35      MNG           Mongolia             46                44          2
## 42      POL             Poland             26                24          2
## 1       AUS          Australia             35                36         -1
## 2       AUT            Austria              7                 8         -1
## 3       BEL            Belgium              5                 4          1
## 17      GBR     United Kingdom             15                14          1
## 24      ITA              Italy             28                27          1
## 36      MYS           Malaysia             40                41         -1
## 38      NOR             Norway              4                 3          1
## 39      NZL        New Zealand             33                34         -1
## 43      PRT           Portugal             27                26          1
## 51      VNM            Vietnam             36                35          1
## 4       BGD         Bangladesh             48                48          0
## 5       BGR           Bulgaria             30                30          0
## 7       CHE        Switzerland              1                 1          0
## 18      GRC             Greece             32                32          0
## 22      IND              India             42                42          0
## 27      KHM           Cambodia             37                37          0
## 30      LTU          Lithuania             16                16          0
## 34      MMR            Myanmar             43                43          0
## 37      NLD        Netherlands              2                 2          0
## 40      PAK           Pakistan             50                50          0
## 41      PHL        Philippines             39                39          0
## 45      RUS Russian Federation             51                51          0
## 46      SGP          Singapore             13                13          0
## 47      SVK           Slovakia             22                22          0
## 48      SVN           Slovenia             10                10          0
## 49      SWE             Sweden              6                 6          0
##    AbsRankChange
## 6              7
## 14             7
## 13             6
## 44             5
## 9              4
## 21             4
## 8              3
## 19             3
## 20             3
## 25             3
## 31             3
## 33             3
## 50             3
## 10             2
## 11             2
## 12             2
## 15             2
## 16             2
## 23             2
## 26             2
## 28             2
## 29             2
## 32             2
## 35             2
## 42             2
## 1              1
## 2              1
## 3              1
## 17             1
## 24             1
## 36             1
## 38             1
## 39             1
## 43             1
## 51             1
## 4              0
## 5              0
## 7              0
## 18             0
## 22             0
## 27             0
## 30             0
## 34             0
## 37             0
## 40             0
## 41             0
## 45             0
## 46             0
## 47             0
## 48             0
## 49             0
```
???

Notes - 
1. Use the "exclude" argument of `assemble()` to exclude the relevant indicators
2. Set the weight of the Political pillar to zero
3. Remove the indicators manually

Here we will take the quickest option, which is Option 2.
The results show that the rank changes are not major at the index level, with a maximum shift of six places for Estonia. The implication might be (depending on context) that the inclusion or not of the Political pillar does not have a drastic impact on the results, although one should bear in mind that the changes on lower aggregation levels are probably higher, and the indicators themselves may have value and add legitimacy to the framework. In other words, it is not always just the index that counts.

---


## Sensitivity analysis:  test the overall effect of uncertainties
 

???

Notes -  

---
class: inverse, left, middle

# Stage 3. Visualize Results

* Index
* SubDimensions
* Maps
* Summary
* Export


---

## Index &amp; Sub Dimensions



.left-column[
 

We can now visualize our results. A good way at the index level is a stacked bar chart.


```r
COINr::iplotBar(ASEM, dset = "Aggregated", 
         isel = "Index", 
         aglev = 4, 
         stack_children = T)
```
 
]

--

.right-column[

<div id="htmlwidget-de6e874a84f330101707" style="width:900px;height:556.2px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-de6e874a84f330101707">{"x":{"visdat":{"44712f3358ce":["function () ","plotlyVisDat"]},"cur_data":"44712f3358ce","attrs":{"44712f3358ce":{"x":{},"y":{},"key":{},"name":"Conn","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"},"44712f3358ce.1":{"x":{},"y":[74.4548456167802,68.3903994276055,72.984587047517,71.7788274306318,64.2341742396999,72.5749070754546,69.2985693672551,56.81833742418,67.9098328992129,68.9716674007193,65.7926327143908,60.9637968255754,57.6991892825095,66.1023604829868,63.6728088969191,66.4772657543424,61.6532131838662,62.0649972175479,60.8678822272939,59.2814319235455,57.2132026799891,59.9131040908634,62.3059670915951,60.6274184659754,65.6537370943831,60.3401006954177,59.0664869695629,56.8603194771632,51.5105979290639,57.1575466581957,57.2995489799116,54.3895698370399,59.5233375387543,58.0209235615006,53.554075246916,55.6165057791429,55.994246771221,40.1032109709557,56.3193877339437,41.1227817399095,50.2887979564375,51.7239816595384,59.665454111438,52.2947665758468,56.2332312514876,48.0624863031439,47.1567805729016,60.8698552648875,48.2003027304709,53.6533367376402,41.476226644861],"key":{},"name":"Sust","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar","inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":{"text":"Sustainable Connectivity","y":0.95},"yaxis":{"domain":[0,1],"automargin":true,"title":"","showticklabels":false},"xaxis":{"domain":[0,1],"automargin":true,"title":"","categoryorder":"array","categoryarray":{"Index":[68.621403668364,65.1651358926319,65.0410383080279,64.6071663752533,64.1121692355648,63.224823201446,62.3642937416572,61.6868684841489,61.1295968310016,60.7497051038254,60.5137694239751,60.2709945407649,59.8030710567783,59.1189300300464,58.2416267711836,57.2939257480353,56.8523358014573,56.1034368331307,55.8882429293819,55.7937082339417,55.3573637246148,55.1587365396442,55.146816044091,55.0829063362119,54.7648797130732,54.2959872906309,54.0784920389337,52.3019881561583,51.6452608367962,50.9378852194357,50.4324063148894,49.8521681997249,49.3797777604972,47.4949280469203,45.959441786501,43.2854587144294,43.2017559236092,41.7270225080216,41.7237550660752,41.7198537081406,41.1580879386198,40.1595694805621,40.1268409828404,40.0841372709449,39.7607259845468,39.4695646071414,39.0616577624139,38.9191348380666,38.2199505267257,37.806472915641,35.731036156064]},"type":"category"},"barmode":"stack","hovermode":"closest","showlegend":true},"source":"barclick","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":["CHE","NLD","DNK","NOR","BEL","SWE","AUT","LUX","DEU","SVN","IRL","MLT","SGP","FIN","GBR","LTU","CZE","HRV","FRA","HUN","EST","SVK","LVA","ESP","ROU","POL","PRT","ITA","CYP","BGR","KOR","GRC","NZL","JPN","AUS","VNM","KHM","BRN","PHL","MYS","THA","IND","MMR","IDN","LAO","MNG","KAZ","BGD","CHN","PAK","RUS"],"y":[62.7879617199478,61.9398723576584,57.0974895685389,57.4355053198748,63.9901642314296,53.8747393274374,55.4300181160593,66.5553995441179,54.3493607627902,52.5277428069315,55.2349061335593,59.5781922559545,61.9069528310472,52.1354995771061,52.8104446454481,48.1105857417282,52.0514584190484,50.1418764487134,50.9086036314699,52.3059845443379,53.5015247692406,50.404368988425,47.9876649965869,49.5383942064484,43.8760223317633,48.2518738858441,49.0904971083045,47.7436568351534,51.7799237445284,44.7182237806758,43.5652636498673,45.3147665624098,39.2362179822402,36.96893253234,38.3648083260859,30.954411649716,30.4092650759974,43.3508340450876,27.1281223982067,42.3169256763717,32.027377920802,28.5951573015857,20.5882278542428,27.873507966043,23.288220717606,30.8766429111389,30.9665349519263,16.9684144112457,28.2395983229804,21.9596090936419,29.985845667267],"key":["CHE","NLD","DNK","NOR","BEL","SWE","AUT","LUX","DEU","SVN","IRL","MLT","SGP","FIN","GBR","LTU","CZE","HRV","FRA","HUN","EST","SVK","LVA","ESP","ROU","POL","PRT","ITA","CYP","BGR","KOR","GRC","NZL","JPN","AUS","VNM","KHM","BRN","PHL","MYS","THA","IND","MMR","IDN","LAO","MNG","KAZ","BGD","CHN","PAK","RUS"],"name":"Conn","type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","_isNestedKey":false,"frame":null},{"x":["CHE","NLD","DNK","NOR","BEL","SWE","AUT","LUX","DEU","SVN","IRL","MLT","SGP","FIN","GBR","LTU","CZE","HRV","FRA","HUN","EST","SVK","LVA","ESP","ROU","POL","PRT","ITA","CYP","BGR","KOR","GRC","NZL","JPN","AUS","VNM","KHM","BRN","PHL","MYS","THA","IND","MMR","IDN","LAO","MNG","KAZ","BGD","CHN","PAK","RUS"],"y":[74.4548456167802,68.3903994276055,72.984587047517,71.7788274306318,64.2341742396999,72.5749070754546,69.2985693672551,56.81833742418,67.9098328992129,68.9716674007193,65.7926327143908,60.9637968255754,57.6991892825095,66.1023604829868,63.6728088969191,66.4772657543424,61.6532131838662,62.0649972175479,60.8678822272939,59.2814319235455,57.2132026799891,59.9131040908634,62.3059670915951,60.6274184659754,65.6537370943831,60.3401006954177,59.0664869695629,56.8603194771632,51.5105979290639,57.1575466581957,57.2995489799116,54.3895698370399,59.5233375387543,58.0209235615006,53.554075246916,55.6165057791429,55.994246771221,40.1032109709557,56.3193877339437,41.1227817399095,50.2887979564375,51.7239816595384,59.665454111438,52.2947665758468,56.2332312514876,48.0624863031439,47.1567805729016,60.8698552648875,48.2003027304709,53.6533367376402,41.476226644861],"key":["CHE","NLD","DNK","NOR","BEL","SWE","AUT","LUX","DEU","SVN","IRL","MLT","SGP","FIN","GBR","LTU","CZE","HRV","FRA","HUN","EST","SVK","LVA","ESP","ROU","POL","PRT","ITA","CYP","BGR","KOR","GRC","NZL","JPN","AUS","VNM","KHM","BRN","PHL","MYS","THA","IND","MMR","IDN","LAO","MNG","KAZ","BGD","CHN","PAK","RUS"],"name":"Sust","type":"bar","marker":{"color":"rgba(255,127,14,1)","line":{"color":"rgba(255,127,14,1)"}},"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","_isNestedKey":false,"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
]
 
???

Notes -

---


## Sub Indices Interactions

.left-column[
 
 


```r
COINr::iplotIndDist2(ASEM, 
    dsets = "Aggregated", 
    icodes = "Index")
```
 
]

--

.right-column[

<div id="htmlwidget-91195e52a788f0c02ac9" style="width:900px;height:556.2px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-91195e52a788f0c02ac9">{"x":{"visdat":{"4471480783b1":["function () ","plotlyVisDat"]},"cur_data":"4471480783b1","attrs":{"4471480783b1":{"mode":"markers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"},"4471480783b1.1":{"mode":"markers","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter","x":{},"y":{},"text":["Austria","Belgium","Bulgaria","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Ireland","Italy","Latvia","Lithuania","Luxembourg","Malta","Netherlands","Norway","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden","Switzerland","United Kingdom","Australia","Bangladesh","Brunei Darussalam","Cambodia","China","India","Indonesia","Japan","Kazakhstan","Korea","Lao PDR","Malaysia","Mongolia","Myanmar","New Zealand","Pakistan","Philippines","Russian Federation","Singapore","Thailand","Vietnam"],"hoverinfo":"text","marker":{"size":15},"showlegend":false,"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":["Trade in goods <br> ()","Trade in services <br> ()","Foreign direct investment <br> ()","Personal remittances (received and paid) <br> ()","Foreign portfolio investment liabilities and assets <br> ()","Cost to export/import <br> ()","Mean tariff rate <br> ()","Technical barriers to trade <br> ()","Signatory of TIR Convention <br> ()","Regional trade agreements <br> ()","Visa-free or visa-on-arrival <br> ()","International student mobility in tertiary education <br> ()","Research outputs with international collaborations <br> ()","Patents with foreign co-inventor <br> ()","Trade in cultural services <br> ()","Trade in cultural goods <br> ()","Tourist arrivals at national borders <br> ()","Migrant stock <br> ()","Common languages users <br> ()","Logistics Performance Index <br> ()","International flights passenger capacity <br> ()","Liner Shipping Connectivity Index <br> ()","Border crossings <br> ()","Trade in electricity <br> ()","Trade in gas <br> ()","Average connection speed <br> ()","Den_Pop covered by at least a 4G mobile network <br> ()","Embassies network <br> ()","Participation in international intergovernmental organisations <br> ()","UN voting alignment <br> ()","Renewable energy in total final energy consumption <br> ()","Primary energy use per GDP <br> ()","CO2 emissions per capita <br> ()","Domestic material consumption per capita <br> ()","Net forest loss <br> ()","Den_Pop living below the intenational poverty line <br> ()","Palma Index <br> ()","Tertiary graduates <br> ()","Freedom of the press <br> ()","Tolerance for minorities <br> ()","Presence of international non-governmental organisations <br> ()","Corruption Perceptions Index <br> ()","Female labour-force participation <br> ()","Women's participation in national parliaments <br> ()","Public debt as a percentage of GDP <br> ()","Private debt, loans and debt securities as percentage of GDP <br> ()","GDP per capita growth <br> ()","R&D expenditure as a percentage of GDP <br> ()","Proportion of youth not in education, employment or training <br> ()"]},"yaxis":{"domain":[0,1],"automargin":true,"title":["Trade in goods <br> ()","Trade in services <br> ()","Foreign direct investment <br> ()","Personal remittances (received and paid) <br> ()","Foreign portfolio investment liabilities and assets <br> ()","Cost to export/import <br> ()","Mean tariff rate <br> ()","Technical barriers to trade <br> ()","Signatory of TIR Convention <br> ()","Regional trade agreements <br> ()","Visa-free or visa-on-arrival <br> ()","International student mobility in tertiary education <br> ()","Research outputs with international collaborations <br> ()","Patents with foreign co-inventor <br> ()","Trade in cultural services <br> ()","Trade in cultural goods <br> ()","Tourist arrivals at national borders <br> ()","Migrant stock <br> ()","Common languages users <br> ()","Logistics Performance Index <br> ()","International flights passenger capacity <br> ()","Liner Shipping Connectivity Index <br> ()","Border crossings <br> ()","Trade in electricity <br> ()","Trade in gas <br> ()","Average connection speed <br> ()","Den_Pop covered by at least a 4G mobile network <br> ()","Embassies network <br> ()","Participation in international intergovernmental organisations <br> ()","UN voting alignment <br> ()","Renewable energy in total final energy consumption <br> ()","Primary energy use per GDP <br> ()","CO2 emissions per capita <br> ()","Domestic material consumption per capita <br> ()","Net forest loss <br> ()","Den_Pop living below the intenational poverty line <br> ()","Palma Index <br> ()","Tertiary graduates <br> ()","Freedom of the press <br> ()","Tolerance for minorities <br> ()","Presence of international non-governmental organisations <br> ()","Corruption Perceptions Index <br> ()","Female labour-force participation <br> ()","Women's participation in national parliaments <br> ()","Public debt as a percentage of GDP <br> ()","Private debt, loans and debt securities as percentage of GDP <br> ()","GDP per capita growth <br> ()","R&D expenditure as a percentage of GDP <br> ()","Proportion of youth not in education, employment or training <br> ()"]},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"mode":"markers","type":"scatter","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"line":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null},{"mode":"markers","type":"scatter","x":[40.7147978302105,80.0790829492294,47.1178543410879,29.6595542299126,21.5525492605235,88.8553124519079,24.3804882124031,75.3754890317444,20.7554972641161,15.0864687872643,29.5283169130779,11.5609768118045,87.2032124615804,23.0805774954351,15.7540188845476,62.5592560718532,59.6935324437879,27.8860822178772,75.179034652212,60.1300025526122,17.8605021462841,44.7279167208669,25.9424245175779,34.1151202706534,100,76.7590567226543,16.2628895134529,22.6777229358393,33.0443479319491,11.5808067789694,6.49608314755034,8.83072346888023,35.288121363973,63.2943152409557,1.73181451143796,0,7.70970515433294,1.42407266048311,19.4924394427823,19.1743392104261,30.5551357206689,56.3972144036942,39.8835633758377,24.7038370008743,8.99879169192228,2.25795082759758,18.1757885716913,10.3132031797815,88.2538120920766,39.4852273246478,82.3897744174304],"y":[32.966091561691,58.6989070002964,28.3984206626414,41.5789859430416,100,25.4588432615058,45.9615309377953,55.3699678161877,25.8834491770973,21.1068590367762,17.6625205478115,22.0742882471442,37.714448289341,100,9.70806589779169,31.0895813109849,34.6609529045343,100,100,56.4284132131985,25.7500080622608,18.9397281887691,24.2365836450423,17.6623445572814,19.6935178192904,31.1698113934496,16.7006920536502,30.2060795010617,37.5903068664518,21.7382469900896,6.1507141012756,0.928181284178657,20.3208459556872,34.7284399244394,2.72186404352122,12.6586110627088,2.64152643768182,4.47162904309004,11.9167064277242,14.3345062290365,6.69379014370325,28.7038906885967,28.4199375588891,7.77020220182281,14.2336295581721,0,19.7108198152618,8.2379417110495,100,31.3969297838429,15.2245559395681],"text":["Austria","Belgium","Bulgaria","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Ireland","Italy","Latvia","Lithuania","Luxembourg","Malta","Netherlands","Norway","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden","Switzerland","United Kingdom","Australia","Bangladesh","Brunei Darussalam","Cambodia","China","India","Indonesia","Japan","Kazakhstan","Korea","Lao PDR","Malaysia","Mongolia","Myanmar","New Zealand","Pakistan","Philippines","Russian Federation","Singapore","Thailand","Vietnam"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"marker":{"color":"rgba(255,127,14,1)","size":15,"line":{"color":"rgba(255,127,14,1)"}},"showlegend":false,"error_y":{"color":"rgba(255,127,14,1)"},"error_x":{"color":"rgba(255,127,14,1)"},"line":{"color":"rgba(255,127,14,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
]
 
 
 

???

Notes -

---


## Display the index on a Map

.left-column[


```r
COINr::iplotMap(ASEM, 
    dset = "Aggregated", 
    isel = "Conn")
```
 
]

--

.right-column[

<div id="htmlwidget-3a6c18fdacf57ab01955" style="width:900px;height:556.2px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-3a6c18fdacf57ab01955">{"x":{"visdat":{"447177885795":["function () ","plotlyVisDat"]},"cur_data":"447177885795","attrs":{"447177885795":{"z":{},"locations":["AUT","BEL","BGR","HRV","CYP","CZE","DNK","EST","FIN","FRA","DEU","GRC","HUN","IRL","ITA","LVA","LTU","LUX","MLT","NLD","NOR","POL","PRT","ROU","SVK","SVN","ESP","SWE","CHE","GBR","AUS","BGD","BRN","KHM","CHN","IND","IDN","JPN","KAZ","KOR","LAO","MYS","MNG","MMR","NZL","PAK","PHL","RUS","SGP","THA","VNM"],"text":{},"colorscale":"Greens","key":["AUT","BEL","BGR","HRV","CYP","CZE","DNK","EST","FIN","FRA","DEU","GRC","HUN","IRL","ITA","LVA","LTU","LUX","MLT","NLD","NOR","POL","PRT","ROU","SVK","SVN","ESP","SWE","CHE","GBR","AUS","BGD","BRN","KHM","CHN","IND","IDN","JPN","KAZ","KOR","LAO","MYS","MNG","MMR","NZL","PAK","PHL","RUS","SGP","THA","VNM"],"showscale":true,"reversescale":true,"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"choropleth"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"zaxis":{"title":"get(isel)"}},"hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5},"title":"Connectivity","geo":{"showframe":false,"showcoastlines":true,"projection":{"type":"Mercator"},"showcountries":false,"bgcolor":"rgba(255,255,255,0)","showframe.1":false,"showland":true,"landcolor":"rgba(229,229,229,1)","countrycolor":"rgba(255,255,255,1)","coastlinecolor":"rgba(255,255,255,1)"}},"source":"mapclick","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"colorbar":{"title":"Conn","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"colorscale":"Greens","showscale":true,"z":[55.4300181160593,63.9901642314296,44.7182237806758,50.1418764487134,51.7799237445284,52.0514584190484,57.0974895685389,53.5015247692406,52.1354995771061,50.9086036314699,54.3493607627902,45.3147665624098,52.3059845443379,55.2349061335593,47.7436568351534,47.9876649965869,48.1105857417282,66.5553995441179,59.5781922559545,61.9398723576584,57.4355053198748,48.2518738858441,49.0904971083045,43.8760223317633,50.404368988425,52.5277428069315,49.5383942064484,53.8747393274374,62.7879617199478,52.8104446454481,38.3648083260859,16.9684144112457,43.3508340450876,30.4092650759974,28.2395983229804,28.5951573015857,27.873507966043,36.96893253234,30.9665349519263,43.5652636498673,23.288220717606,42.3169256763717,30.8766429111389,20.5882278542428,39.2362179822402,21.9596090936419,27.1281223982067,29.985845667267,61.9069528310472,32.027377920802,30.954411649716],"locations":["AUT","BEL","BGR","HRV","CYP","CZE","DNK","EST","FIN","FRA","DEU","GRC","HUN","IRL","ITA","LVA","LTU","LUX","MLT","NLD","NOR","POL","PRT","ROU","SVK","SVN","ESP","SWE","CHE","GBR","AUS","BGD","BRN","KHM","CHN","IND","IDN","JPN","KAZ","KOR","LAO","MYS","MNG","MMR","NZL","PAK","PHL","RUS","SGP","THA","VNM"],"text":["Austria","Belgium","Bulgaria","Croatia","Cyprus","Czech Republic","Denmark","Estonia","Finland","France","Germany","Greece","Hungary","Ireland","Italy","Latvia","Lithuania","Luxembourg","Malta","Netherlands","Norway","Poland","Portugal","Romania","Slovakia","Slovenia","Spain","Sweden","Switzerland","United Kingdom","Australia","Bangladesh","Brunei Darussalam","Cambodia","China","India","Indonesia","Japan","Kazakhstan","Korea","Lao PDR","Malaysia","Mongolia","Myanmar","New Zealand","Pakistan","Philippines","Russian Federation","Singapore","Thailand","Vietnam"],"key":["AUT","BEL","BGR","HRV","CYP","CZE","DNK","EST","FIN","FRA","DEU","GRC","HUN","IRL","ITA","LVA","LTU","LUX","MLT","NLD","NOR","POL","PRT","ROU","SVK","SVN","ESP","SWE","CHE","GBR","AUS","BGD","BRN","KHM","CHN","IND","IDN","JPN","KAZ","KOR","LAO","MYS","MNG","MMR","NZL","PAK","PHL","RUS","SGP","THA","VNM"],"reversescale":true,"type":"choropleth","marker":{"line":{"color":"rgba(31,119,180,1)"}},"_isNestedKey":false,"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
]
 
 

???

Notes -

---


## Present summary table.


```r
COINr::getResults(ASEM, tab_type = "Summary") %&gt;%
  head(7)%&gt;%
  knitr::kable()
```



|UnitCode |UnitName    | Index| Rank|
|:--------|:-----------|-----:|----:|
|CHE      |Switzerland | 68.62|    1|
|NLD      |Netherlands | 65.17|    2|
|DNK      |Denmark     | 65.04|    3|
|NOR      |Norway      | 64.61|    4|
|BEL      |Belgium     | 64.11|    5|
|SWE      |Sweden      | 63.22|    6|
|AUT      |Austria     | 62.36|    7|


???

Notes -

---


## Export Results

Get tables to present (the highest levels of aggregation are the first columns, rather than the last, and it is sorted by index score).


```r
# Write full results table to COIN
COINr::getResults(ASEM, tab_type = "FullWithDenoms", out2 = "COIN")

# Export entire COIN to Excel
COINr::coin2Excel(ASEM, "ASEM_results.xlsx")
```

???

Notes -

---
class: inverse, left, middle

# Conclusion. Reproducibility to ensure transparency

 * Strictly Use "curated &amp; published" data for your sub-indicators - Data should be available on [HDX](https://data.humdata.org)
 
 * Put Code into github to document your process - the data structure required for the packages allows for better discoverability!
 
 * Call for peer and/or independent review to cover yourself! when using scripted reproducible analysis, this should be very quick!!!

    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": true,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
